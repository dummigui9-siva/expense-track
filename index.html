<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Expense Tracker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
    --bg:#ffffff;
    --text:#000;
    --card:#ffffff;
    --primary:#2d89ef;
}
body.dark {
    --bg:#121212;
    --text:#e0e0e0;
    --card:#1e1e1e;
}
* { box-sizing:border-box; }
body {
    margin:0;
    font-family:Arial, sans-serif;
    background:var(--bg);
    color:var(--text);
}
.container {
    max-width:520px;
    margin:20px auto;
    background:var(--card);
    padding:18px;
    border-radius:14px;
    box-shadow:0 8px 20px rgba(0,0,0,0.2);
}
h1 { text-align:center; }

label {
    display:block;
    margin-top:12px;
    font-weight:bold;
}
input, select {
    width:100%;
    padding:12px;
    margin-top:6px;
    font-size:16px;
    border-radius:14px;
    border:1px solid #ccc;
}
button {
    padding:12px 18px;
    margin-top:10px;
    font-size:16px;
    border:none;
    border-radius:999px;
    background:var(--primary);
    color:white;
    cursor:pointer;
    transition:all 0.2s ease;
    box-shadow:
        inset 0 -2px 4px rgba(0,0,0,0.2),
        0 4px 6px rgba(0,0,0,0.2);
}
button:hover {
    transform:translateY(-2px);
    box-shadow:
        inset 0 -1px 2px rgba(0,0,0,0.15),
        0 8px 14px rgba(0,0,0,0.25);
}
.full-btn { width:100%; }

.edit-btn { background:orange; }
.delete-btn { background:black; }

table {
    width:100%;
    border-collapse:collapse;
    margin-top:14px;
}
th, td {
    border:1px solid #ccc;
    padding:8px;
    text-align:center;
}
th {
    background:var(--primary);
    color:white;
}

/* Category colors */
.Food { background:#ff6b6b; }
.Travel { background:#4ecdc4; }
.Shopping { background:#ffd93d; color:black; }
.Other { background:#6a4c93; color:white; }

/* Legend */
.legend {
    display:flex;
    justify-content:space-around;
    margin:14px 0;
}
.legend span {
    padding:6px 12px;
    border-radius:999px;
    font-size:14px;
    color:white;
}
.legend .Food { background:#ff6b6b; }
.legend .Travel { background:#4ecdc4; }
.legend .Shopping { background:#ffd93d; color:black; }
.legend .Other { background:#6a4c93; }
</style>
</head>

<body>
<div class="container">

<h1>Expense Tracker</h1>

<button class="full-btn" onclick="toggleDarkMode()">Toggle Dark Mode</button>

<label>User Name</label>
<input type="text" id="username" placeholder="Enter your name">

<label>Amount</label>
<input type="number" id="amount">

<label>Category</label>
<select id="category">
    <option value="">Select</option>
    <option>Food</option>
    <option>Travel</option>
    <option>Shopping</option>
    <option>Other</option>
</select>

<label>Date</label>
<input type="date" id="date">

<button id="addBtn" class="full-btn" onclick="addExpense()">Add Expense</button>

<h3 id="total">Total: ₹0</h3>

<div class="legend">
    <span class="Food">Food</span>
    <span class="Travel">Travel</span>
    <span class="Shopping">Shopping</span>
    <span class="Other">Other</span>
</div>

<label>Filter by Category</label>
<select id="categoryFilter" onchange="applyFilters()">
    <option value="All">All</option>
    <option>Food</option>
    <option>Travel</option>
    <option>Shopping</option>
    <option>Other</option>
</select>

<button class="full-btn" onclick="exportCSV()">Export CSV</button>

<table>
<thead>
<tr>
    <th>Date</th>
    <th>Category</th>
    <th>Amount</th>
    <th>Actions</th>
</tr>
</thead>
<tbody id="summaryBody"></tbody>
</table>

</div>

<script>
/* ---------- Dark Mode ---------- */
if(localStorage.getItem("darkMode")==="on"){
    document.body.classList.add("dark");
}
function toggleDarkMode(){
    document.body.classList.toggle("dark");
    localStorage.setItem(
        "darkMode",
        document.body.classList.contains("dark") ? "on" : "off"
    );
}

/* ---------- Username ---------- */
username.value = localStorage.getItem("username") || "";
username.oninput = () =>
    localStorage.setItem("username", username.value);

/* ---------- Core Data ---------- */
let expenses = JSON.parse(localStorage.getItem("expenses")) || [];
let editId = null;

applyFilters();

function addExpense(){
    if(!amount.value || !category.value || !date.value){
        alert("Fill all fields"); return;
    }
    if(editId){
        expenses = expenses.map(e =>
            e.id === editId
                ? {...e, amount:amount.value, category:category.value, date:date.value}
                : e
        );
        editId = null;
        addBtn.innerText = "Add Expense";
    } else {
        expenses.push({
            id: Date.now(),
            amount: amount.value,
            category: category.value,
            date: date.value
        });
    }
    localStorage.setItem("expenses", JSON.stringify(expenses));
    amount.value = category.value = date.value = "";
    applyFilters();
}

function applyFilters(){
    let list = [...expenses];
    let c = categoryFilter.value;
    if(c !== "All") list = list.filter(e => e.category === c);
    display(list);
}

function display(list){
    total.innerText = "Total: ₹" +
        list.reduce((s,e)=>s+Number(e.amount),0);

    summaryBody.innerHTML = "";
    list.forEach(e=>{
        let tr = document.createElement("tr");
        tr.className = e.category;
        tr.innerHTML = `
            <td>${e.date}</td>
            <td>${e.category}</td>
            <td>${e.amount}</td>
            <td>
                <button class="edit-btn" onclick="editExpense(${e.id})">Edit</button>
                <button class="delete-btn" onclick="deleteExpense(${e.id})">X</button>
            </td>`;
        summaryBody.appendChild(tr);
    });
}

/* ---------- Edit UX retained ---------- */
function editExpense(id){
    window.scrollTo({ top:0, behavior:"smooth" });
    let e = expenses.find(x=>x.id===id);
    amount.value = e.amount;
    category.value = e.category;
    date.value = e.date;
    setTimeout(()=>category.focus(),300);
    editId = id;
    addBtn.innerText = "Update Expense";
}

function deleteExpense(id){
    expenses = expenses.filter(e=>e.id!==id);
    localStorage.setItem("expenses", JSON.stringify(expenses));
    applyFilters();
}

/* ---------- CSV Export ---------- */
function exportCSV(){
    let user = username.value || "User";
    let lines = [];
    lines.push("User Name," + user);
    lines.push("");
    lines.push("Date,Category,Amount");

    expenses.forEach(e=>{
        lines.push(`${e.date},${e.category},${e.amount}`);
    });

    let blob = new Blob([lines.join("\n")], { type:"text/csv" });
    let a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "Expense_Report.csv";
    a.click();
}
</script>
</body>
</html>
